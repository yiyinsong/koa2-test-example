"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function a(o,n){try{var u=t[o](n),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then(function(e){a("next",e)},function(e){a("throw",e)});e(i)}return a("next")})}}Object.defineProperty(exports,"__esModule",{value:!0});var _regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_fs=require("fs"),_fs2=_interopRequireDefault(_fs),_path=require("path"),_path2=_interopRequireDefault(_path),_config=require("../../utils/config"),_config2=_interopRequireDefault(_config),upload=function(){var e=_asyncToGenerator(_regenerator2.default.mark(function e(t,r){var a,o,n,u,i,f,s,l,c;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.request.body.fields,o=t.request.body.files.file,n={},o)if(a.rootPath){for(u=(_config2.default.uploadPath+a.rootPath).split("/"),i="";u.length;)i+=u.shift()+"/",_fs2.default.existsSync(i)||_fs2.default.mkdirSync(i);f=(new Date).getTime()+o.name.substr(o.name.lastIndexOf(".")),s=_fs2.default.createReadStream(o.path),l=_fs2.default.createWriteStream(_config2.default.uploadPath+a.rootPath+"/"+f),s.pipe(l),c=_config2.default.uploadLocalPath+a.rootPath+"/"+f,n={code:1,message:"上传成功",path:c}}else n={code:0,message:"请传入rootPath",path:""};else n={code:0,message:"参数错误",path:""};t.body=n;case 5:case"end":return e.stop()}},e,void 0)}));return function(t,r){return e.apply(this,arguments)}}();exports.default={upload:upload};