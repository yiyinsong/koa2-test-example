"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,u){try{var i=r[a](u),o=i.value}catch(e){return void t(e)}if(!i.done)return Promise.resolve(o).then(function(e){n("next",e)},function(e){n("throw",e)});e(o)}return n("next")})}}Object.defineProperty(exports,"__esModule",{value:!0});var _regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_playlist=require("../models/playlist"),_playlist2=_interopRequireDefault(_playlist),list=function(){var e=_asyncToGenerator(_regenerator2.default.mark(function e(r,t){var n,a,u,i,o;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.request.query,a=n.page&&Number(n.page),u=n.limit&&Number(n.limit),u=u||20,a=a||1,e.next=7,_playlist2.default.find().skip((a-1)*u).limit(u);case 7:return i=e.sent,e.next=10,_playlist2.default.count();case 10:return o=e.sent,i=i||[],e.next=14,r.render("./backend/list",{title:"歌单",data:i,limit:u||20,page:a,total:Math.ceil(o/u)});case 14:case"end":return e.stop()}},e,void 0)}));return function(r,t){return e.apply(this,arguments)}}(),remove=function(){var e=_asyncToGenerator(_regenerator2.default.mark(function e(r,t){var n,a;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.request.query,!(a=n.id)){e.next=6;break}return e.next=5,_playlist2.default.removeOne({id:a});case 5:return e.abrupt("return",r.redirect("/admin/list"));case 6:console.log("删除失败");case 7:case"end":return e.stop()}},e,void 0)}));return function(r,t){return e.apply(this,arguments)}}(),removeMulti=function(){var e=_asyncToGenerator(_regenerator2.default.mark(function e(r,t){var n,a;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.request.query,a=n.ids,console.log(a),!a){e.next=9;break}return a=a.split(","),console.log(a),e.next=8,_playlist2.default.removeMulti("id",a);case 8:return e.abrupt("return",r.redirect("/admin/list"));case 9:console.log("删除失败");case 10:case"end":return e.stop()}},e,void 0)}));return function(r,t){return e.apply(this,arguments)}}();exports.default={list:list,remove:remove,removeMulti:removeMulti};