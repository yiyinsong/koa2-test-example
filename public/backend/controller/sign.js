"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,n){function t(o,a){try{var u=r[o](a),s=u.value}catch(e){return void n(e)}if(!u.done)return Promise.resolve(s).then(function(e){t("next",e)},function(e){t("throw",e)});e(s)}return t("next")})}}Object.defineProperty(exports,"__esModule",{value:!0});var _regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_mongoose=require("mongoose"),_mongoose2=_interopRequireDefault(_mongoose),_config=require("../utils/config"),_config2=_interopRequireDefault(_config),_user=require("../models/user"),_user2=_interopRequireDefault(_user),register=function(){var e=_asyncToGenerator(_regenerator2.default.mark(function e(r,n){return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.render("./frontend/sign",{title:"注册",type:0});case 2:case"end":return e.stop()}},e,void 0)}));return function(r,n){return e.apply(this,arguments)}}(),login=function(){var e=_asyncToGenerator(_regenerator2.default.mark(function e(r,n){return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.render("./frontend/sign",{title:"登录",type:1});case 2:case"end":return e.stop()}},e,void 0)}));return function(r,n){return e.apply(this,arguments)}}(),registerHandle=function(){var e=_asyncToGenerator(_regenerator2.default.mark(function e(r,n){var t,o,a,u,s,i;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.request.body,o="",t.username&&""!==t.username?t.tel&&""!==t.tel?t.icon&&""!==t.icon?t.password!==t.repassword&&(o="密码与确认密码不一致"):o="参数异常，请传入用户头像":o="参数异常，请传入手机号码":o="参数异常，请传入用户名",""!==o){e.next=26;break}return e.prev=4,e.next=7,_user2.default.findByName(t.username);case 7:if(!(a=e.sent)){e.next=12;break}r.body="用户名称已存在，请重新填写用户名",e.next=19;break;case 12:return u={username:t.username,tel:t.tel,icon:t.icon,password:t.password},s=new _user2.default(u),e.next=16,s.save();case 16:i=e.sent,console.log(i),r.body="注册成功！";case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(4),console.log(e.t0);case 24:e.next=27;break;case 26:r.body=o;case 27:case"end":return e.stop()}},e,void 0,[[4,21]])}));return function(r,n){return e.apply(this,arguments)}}();exports.default={register:register,registerHandle:registerHandle,login:login};